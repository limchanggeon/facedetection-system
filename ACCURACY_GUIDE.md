# 🎯 얼굴 인식 정확도 가이드

이 가이드는 얼굴 인식 시스템의 정확도를 최적화하는 방법을 설명합니다.

## 📊 주요 설정 파라미터

### 🚀 빠른 설정 프리셋 (권장)

GUI에서 원클릭으로 최적 설정 적용:

#### ⚡ 고속 모드 (기본 권장)
- **FPS**: 25-30 (최고 성능)
- **탐지 거리**: 1-2m (가까운 거리)
- **동시 인원**: 3-5명
- **설정값**:
  - 매칭 엄격도: 0.45
  - 원거리 감도: 0
  - 프레임 스케일: 0.25
- **용도**: 일반 데스크톱 웹캠, 빠른 응답 필요

#### ⚖️ 균형 모드
- **FPS**: 18-22 (양호)
- **탐지 거리**: 2-4m (중거리)
- **동시 인원**: 5-7명
- **설정값**:
  - 매칭 엄격도: 0.40
  - 원거리 감도: 1
  - 프레임 스케일: 0.25
- **용도**: 회의실, 일반적인 사용

#### 🎥 CCTV 모드
- **FPS**: 10-15 (느림, 높은 CPU 사용)
- **탐지 거리**: 1-7m (원거리)
- **동시 인원**: 7-10명
- **설정값**:
  - 매칭 엄격도: 0.35
  - 원거리 감도: 2
  - 프레임 스케일: 0.5
- **용도**: 보안 카메라, 넓은 공간 모니터링

---

### 1. 매칭 엄격도 (Tolerance)
- **범위**: 0.3 ~ 0.6
- **기본값**: 0.4
- **낮은 값 (0.3)**: 더 엄격한 매칭, 오탐지(False Positive) 감소
- **높은 값 (0.6)**: 더 관대한 매칭, 미인식(False Negative) 감소

#### 사용 시나리오:
| 상황 | 권장 값 | 설명 |
|------|---------|------|
| **보안이 중요한 환경** | 0.3 - 0.35 | 등록된 사람만 확실하게 인식 |
| **일반적인 사용** | 0.4 - 0.45 | 균형 잡힌 인식 |
| **편의성 우선** | 0.5 - 0.6 | 조명/각도 변화에도 인식 |

### 2. 원거리 감도 (Upsample Times)
- **범위**: 0 ~ 2
- **기본값**: 2 (CCTV 모드)
- **0**: 가까운 얼굴만 탐지, 빠른 처리
- **1**: 중거리 얼굴 탐지, 균형
- **2**: 원거리 얼굴 탐지, CCTV 스타일

#### 사용 시나리오:
| 상황 | 권장 값 | 설명 |
|------|---------|------|
| **데스크톱 웹캠** | 0 - 1 | 가까운 거리에서 사용 |
| **회의실 카메라** | 1 - 2 | 중거리 여러 사람 |
| **CCTV/보안 카메라** | 2 | 원거리 멀티 얼굴 탐지 |

### 3. 프레임 스케일 (Frame Scale)
- **범위**: 0.25 ~ 1.0
- **기본값**: 0.5
- **코드에서 조정 가능**

```python
self.frame_scale = 0.5  # face_recognition_gui.py에서 수정
```

| 값 | 처리 속도 | 정확도 | 권장 환경 |
|----|----------|--------|----------|
| 0.25 | 매우 빠름 | 낮음 | 저사양 PC |
| 0.5 | 빠름 | 중간 | 일반 사용 (기본) |
| 0.75 | 보통 | 높음 | 고사양 PC |
| 1.0 | 느림 | 최고 | GPU 가속 환경 |

---

## 🔍 오탐지(False Positive) 해결 방법

### 문제: "등록 안 된 사람을 등록된 사람으로 인식"

#### 해결 방법 1: 매칭 엄격도 낮추기 ⭐ (가장 효과적)
```
GUI에서 "매칭 엄격도" 슬라이더를 왼쪽(0.3-0.35)으로 이동
```

#### 해결 방법 2: 다양한 각도로 얼굴 등록
등록된 사람의 얼굴을 여러 각도에서 촬영하여 등록:
1. 정면
2. 약간 왼쪽
3. 약간 오른쪽
4. 약간 위
5. 약간 아래

**현재 시스템은 한 사람당 한 장만 등록 가능합니다.**
향후 업데이트에서 다중 이미지 등록 기능 추가 예정입니다.

#### 해결 방법 3: 조명 환경 개선
- 얼굴에 직접적인 조명
- 역광 피하기
- 그림자 최소화

#### 해결 방법 4: 등록 사진 품질 향상
- 고해상도 카메라 사용
- 얼굴을 카메라에 가깝게
- 정면을 바라보며 촬영
- 안경/마스크 제거

---

## 🚫 미인식(False Negative) 해결 방법

### 문제: "등록된 사람을 인식하지 못함"

#### 해결 방법 1: 매칭 엄격도 높이기
```
GUI에서 "매칭 엄격도" 슬라이더를 오른쪽(0.5-0.6)으로 이동
```

#### 해결 방법 2: 원거리 감도 높이기
```
GUI에서 "원거리 감도" 슬라이더를 오른쪽(2)으로 이동
```

#### 해결 방법 3: 등록 환경과 유사하게 유지
- 같은 조명 환경
- 같은 거리
- 같은 각도

#### 해결 방법 4: 얼굴 재등록
현재 환경에서 다시 얼굴을 촬영하여 등록

---

## 🎥 CCTV/보안 모드 최적 설정

### 목표: 여러 사람을 멀리서도 정확하게 탐지

#### 권장 설정:
```
매칭 엄격도: 0.35 - 0.4 (엄격)
원거리 감도: 2 (최대)
프레임 스케일: 0.5 (코드에서)
신뢰도 표시: 활성화 (체크)
```

#### 환경 요구사항:
- **해상도**: 1080p 이상 카메라
- **조명**: 충분한 실내 조명
- **거리**: 1-5m 범위
- **CPU**: Intel i7 이상 또는 Jetson Xavier NX 이상

#### 예상 성능:
- **FPS**: 10-15 (원거리 감도 2일 때)
- **동시 탐지**: 최대 10명
- **탐지 거리**: 최대 5-7m

---

## 💡 실전 팁

### 0. 성능이 느려서 답답한 경우 ⭐ 최우선
```
GUI에서 "⚡ 고속 모드" 버튼 클릭!
→ 즉시 25-30 FPS로 향상
→ 대부분의 경우 이것만으로 충분
```

### 1. 오탐지가 자주 발생하는 경우
```
1. 매칭 엄격도를 0.35로 낮춤
2. 신뢰도 표시를 활성화하여 %를 확인
3. 70% 미만이면 Unknown으로 판정하도록 코드 수정 고려
```

### 2. 등록된 사람이 인식 안 되는 경우
```
1. 원거리 감도를 2로 높임
2. 조명 환경 확인
3. 카메라에 가까이 이동
4. 얼굴 재등록
```

### 3. 멀리 있는 사람이 탐지 안 되는 경우
```
1. 원거리 감도를 2로 설정
2. 프레임 스케일을 0.75로 증가 (코드 수정)
3. 카메라 해상도 확인 (1080p 권장)
```

### 4. 여러 사람이 동시에 인식되지 않는 경우
```
✅ 이제 해결됨!
- 멀티 얼굴 탐지가 자동으로 작동합니다
- 원거리 감도를 2로 설정하면 더 많은 얼굴 탐지
- 최대 10명까지 동시 인식 가능
```

### 5. 성능이 느린 경우
```
1. 원거리 감도를 0-1로 낮춤
2. 프레임 스케일을 0.25로 감소 (코드 수정)
3. process_every_n_frames를 5로 증가 (코드 수정)
```

---

## 🧪 테스트 시나리오

### 시나리오 1: 사무실 출입 관리
```yaml
목표: 등록된 직원만 정확하게 인식
설정:
  - 매칭 엄격도: 0.35 (엄격)
  - 원거리 감도: 1 (중간)
  - 거리: 1-2m
  - 조명: 밝은 실내
예상 결과: 오탐지 거의 없음, 빠른 인식
```

### 시나리오 2: 회의실 참석 확인
```yaml
목표: 여러 참석자 동시 인식
설정:
  - 매칭 엄격도: 0.4 (보통)
  - 원거리 감도: 2 (최대)
  - 거리: 2-4m
  - 조명: 회의실 조명
예상 결과: 5-10명 동시 인식
```

### 시나리오 3: 가정용 스마트 도어벨
```yaml
목표: 가족 구성원 인식
설정:
  - 매칭 엄격도: 0.45 (관대)
  - 원거리 감도: 1 (중간)
  - 거리: 0.5-1.5m
  - 조명: 다양함 (낮/밤)
예상 결과: 편리한 인식, 약간의 오탐지 허용
```

### 시나리오 4: CCTV 보안 모니터링
```yaml
목표: 넓은 공간의 모든 얼굴 탐지
설정:
  - 매칭 엄격도: 0.35 (엄격)
  - 원거리 감도: 2 (최대)
  - 거리: 1-7m
  - 조명: CCTV 적외선
예상 결과: 원거리 멀티 탐지, 느린 FPS 허용
```

---

## 📈 신뢰도 점수 해석

### 신뢰도 표시를 활성화하면 각 얼굴 옆에 %가 표시됩니다.

| 신뢰도 | 의미 | 조치 |
|--------|------|------|
| **90% 이상** | 매우 확실한 매칭 | 안전하게 인식 |
| **70-89%** | 높은 확률의 매칭 | 대부분 정확 |
| **50-69%** | 중간 확률의 매칭 | 주의 필요 |
| **50% 미만** | 낮은 확률의 매칭 | Unknown 권장 |

### 신뢰도 임계값 설정 (고급)

코드에서 신뢰도 기반 필터링 추가:

```python
# face_recognition_gui.py의 process_video() 함수에서

if confidence < 0.7:  # 70% 미만은 Unknown
    name = "Unknown"
```

---

## 🔧 고급 설정 (코드 수정)

### 1. 처리 간격 조정
```python
# face_recognition_gui.py, process_video() 함수
process_every_n_frames = 3  # 3, 5, 10 등으로 조정
```

### 2. 프레임 해상도 조정
```python
# __init__() 함수
self.frame_scale = 0.5  # 0.25 ~ 1.0
```

### 3. 거리 임계값 조정
```python
# __init__() 함수
self.distance_threshold = 0.45  # 0.3 ~ 0.6
```

### 4. CNN 모델 사용 (GPU 필요)
```python
# process_video() 함수
face_locations = face_recognition.face_locations(
    rgb_small_frame, 
    model="cnn"  # "hog" → "cnn" 변경
)
```

**주의**: CNN 모델은 GPU가 없으면 매우 느립니다!

---

## 📊 성능 vs 정확도 트레이드오프

| 설정 | FPS | 정확도 | 탐지 거리 | CPU 사용률 |
|------|-----|--------|-----------|-----------|
| **빠른 모드** | 25-30 | 중간 | 가까움 | 낮음 |
| frame_scale=0.25, upsample=0 |||||
| **균형 모드** | 18-22 | 높음 | 중간 | 중간 |
| frame_scale=0.5, upsample=1 |||||
| **정확 모드** | 10-15 | 최고 | 원거리 | 높음 |
| frame_scale=0.5, upsample=2 |||||
| **최고 모드** | 5-10 | 최고 | 원거리 | 매우 높음 |
| frame_scale=1.0, upsample=2 |||||

---

## 🎓 학습 및 튜닝 프로세스

### 1단계: 기본 설정으로 시작
```
매칭 엄격도: 0.4
원거리 감도: 2
신뢰도 표시: 활성화
```

### 2단계: 문제 파악
- 오탐지가 많은가? → 매칭 엄격도 낮추기
- 미인식이 많은가? → 매칭 엄격도 높이기
- 멀리서 탐지 안 됨? → 원거리 감도 높이기
- 느림? → 원거리 감도 낮추기

### 3단계: 점진적 조정
작은 단위로 조정하고 테스트:
- 한 번에 0.05씩 조정
- 각 설정 후 충분히 테스트
- 신뢰도 % 관찰

### 4단계: 최적값 기록
```
나의 환경에서 최적 설정:
- 매칭 엄격도: _____
- 원거리 감도: _____
- 조명 환경: _____
- 카메라 거리: _____
- 평균 FPS: _____
- 평균 신뢰도: _____
```

---

## 🆘 FAQ

### Q1: 쌍둥이를 구별할 수 있나요?
**A**: 매우 어렵습니다. 매칭 엄격도를 0.3 이하로 낮추면 약간 도움이 되지만 완벽하지 않습니다.

### Q2: 마스크를 착용해도 인식되나요?
**A**: 아니요. 얼굴의 50% 이상이 가려지면 인식 불가능합니다.

### Q3: 안경을 착용하면?
**A**: 일반 안경은 문제없으나, 선글라스는 인식률이 떨어집니다.

### Q4: 조명이 어두우면?
**A**: 얼굴이 명확히 보이는 최소 조도가 필요합니다. 적외선 카메라 사용 권장.

### Q5: 사진으로 속일 수 있나요?
**A**: 예. 이 시스템은 2D 얼굴 인식이므로 사진/비디오로 속일 수 있습니다. 보안이 중요하면 3D 얼굴 인식이나 라이브니스 감지 필요.

### Q6: 최대 몇 명까지 등록 가능한가요?
**A**: 이론상 무제한이지만, 100명 이상 시 인식 속도가 느려질 수 있습니다.

### Q7: 실시간으로 몇 명까지 동시 탐지 가능한가요?
**A**: 일반 PC에서 10명, Jetson Xavier NX에서 5-7명 정도입니다.

---

## 📚 추가 자료

- [face_recognition 라이브러리 문서](https://github.com/ageitgey/face_recognition)
- [dlib 얼굴 인식 논문](http://dlib.net/face_recognition.py.html)
- [HOG vs CNN 모델 비교](https://medium.com/@ageitgey/machine-learning-is-fun-part-4-modern-face-recognition-with-deep-learning-c3cffc121d78)

---

## 📝 라이센스

MIT License - 자세한 내용은 [LICENSE](LICENSE) 파일 참조

---

**마지막 업데이트**: 2025년 10월 27일
**버전**: 2.0 (멀티 얼굴 탐지 지원)
